import{p as S}from"./stores.986fa1bf.js";import{w as u,d as v}from"./index.17127d3e.js";import{u as m,L as b}from"./index.8d01d5d1.js";import{g}from"./utils.56bee90e.js";import{al as h}from"./index.8e69b878.js";class y{constructor(l){this.current=l,this.max=l}add(l){this.current+=l,this.current>this.max&&(this.max=this.current)}}class j{constructor(l,o,r){this.emoji=l,o&&(this.inventory=o),r&&(this.hp=new y(r))}}class x{constructor(l,o,r){this.emoji=l,this.hp=o,this.type=r}}class _{constructor(l=new Map,o=new Map,r=new Map,e=m){this.ssi=0,this.items=l,this.colors=o,this.backgrounds=r,this.dbg=e}}class L{constructor(l,o){this.name=l,this.sequence=o}}class U{constructor(l,o,r,e,s,t){this.type=l,this.index=o,this.background=r,this.duration=e,this.points=s,this.emoji=t}}class B{constructor(l,o){this.to=l,this.at=o}}class z{constructor(l){this.to=l}}class F{constructor(l,o,r,e,s,t,a){this.emoji=l,this.sequenceID=o,this.hp=r,this.sideEffects=e,this.evolve=s,this.devolve=t,this.drops=a}}class G{constructor(l,o,r,e,s){this.emoji=l,this.hp=o,this.sideEffects=r,this.evolve=e,this.devolve=s}}class k{constructor(l,o,r){this.label=l,this.text=o,this.next=r}}function f(n){const{set:l,subscribe:o,update:r}=u(new Map);return{set:l,subscribe:o,useStorage:e=>{const s=JSON.parse(localStorage.getItem(e+"_"+n));l(new Map(s)||new Map),o(t=>{localStorage.setItem(e+"_"+n,JSON.stringify(Array.from(t.entries())))})},add:(e,s)=>r(t=>(t.set(e,s),t)),update:(e,s)=>r(t=>(t.set(e,s),t)),remove:e=>r(s=>(s.delete(e),s))}}function w(){const{set:n,subscribe:l,update:o}=u({saves:new Map,currentSaveID:"",currentSaveName:"",loaded:!1});return{set:n,subscribe:l,useStorage:()=>{const r=localStorage.getItem("currentSaveID"),e=JSON.parse(localStorage.getItem("saves"));if(h(S).route.id==="editor"&&(r===""||r===null))return!1;let s=new Map(e)||new Map;return o(t=>(t.saves=s,t.currentSaveID=r||"",t.currentSaveName=s.get(r||"")||"",t.loaded=!0,t)),l(t=>{localStorage.setItem("saves",JSON.stringify(Array.from(t.saves.entries()))),localStorage.setItem("currentSaveID",t.currentSaveID)}),!0},rename:(r,e)=>o(s=>(s.saves.set(r,e),s)),add:r=>o(e=>{let s=g();return e.currentSaveID=s,e.currentSaveName=r,e.saves.set(s,r),e}),delete:r=>o(e=>{for(let s of b)localStorage.removeItem(r+"_"+s);return e.currentSaveID="",e.saves.delete(r),e})}}function I(){const{set:n,subscribe:l,update:o}=u(new _);return{set:n,subscribe:l,useStorage:r=>{const e=parseInt(localStorage.getItem(r+"_ssi")||"0"),s=localStorage.getItem(r+"_dbg")||m,t=JSON.parse(localStorage.getItem(r+"_items")),a=JSON.parse(localStorage.getItem(r+"_colors")),i=JSON.parse(localStorage.getItem(r+"_backgrounds"));o(c=>(c.ssi=e,c.items=new Map(t)||new Map,c.colors=new Map(a)||new Map,c.backgrounds=new Map(i)||new Map,c.dbg=s||"",c)),l(c=>{localStorage.setItem(r+"_items",JSON.stringify(Array.from(c.items.entries()))),localStorage.setItem(r+"_colors",JSON.stringify(Array.from(c.colors.entries()))),localStorage.setItem(r+"_backgrounds",JSON.stringify(Array.from(c.backgrounds.entries()))),localStorage.setItem(r+"_dbg",c.dbg),localStorage.setItem(r+"_ssi",c.ssi)})},updateStartingSection:r=>o(e=>(e.ssi=r,e)),updateDefaultColor:r=>o(e=>(e.dbg=r,e)),updateColorAt:(r,e,s)=>o(t=>(t.colors.set(`${r}_${e}`,s),t)),deleteColorAt:(r,e)=>o(s=>(s.colors.delete(`${r}_${e}`),s)),clearColors:r=>o(e=>{let s=[];for(let t of e.colors.keys())+t.split("_")[0]==r&&s.push(t);for(let t of s)e.colors.delete(t);return e}),filterColors:()=>o(r=>{for(let[e,s]of r.colors)s===r.dbg&&r.colors.delete(e);return r}),updateBackgroundAt:(r,e,s)=>o(t=>(t.backgrounds.set(`${r}_${e}`,s),t)),deleteBackgroundAt:(r,e)=>o(s=>(s.backgrounds.delete(`${r}_${e}`),s)),clearBackgrounds:r=>o(e=>{let s=[];for(let t of e.backgrounds.keys())+t.split("_")[0]==r&&s.push(t);for(let t of s)e.items.delete(t);return e}),addEmoji:(r,e,s)=>o(t=>(t.items.set(`${r}_${e}`,s),t)),removeEmoji:(r,e)=>o(s=>(s.items.delete(`${r}_${e}`),s)),clearItems:r=>o(e=>{let s=[];for(let t of e.items.keys())+t.split("_")[0]==r&&s.push(t);for(let t of s)e.items.delete(t);return e}),clearAll:r=>o(e=>{let s=[];for(let t of e.items.keys())+t.split("_")[0]==r&&s.push(t);for(let t of s)e.items.delete(t);s=[];for(let t of e.colors.keys())+t.split("_")[0]==r&&s.push(t);for(let t of s)e.colors.delete(t);s=[];for(let t of e.backgrounds.keys())+t.split("_")[0]==r&&s.push(t);for(let t of s)e.backgrounds.delete(t);return e}),hasControllable:()=>{let r=!1;return o(e=>{let s=[];for(let{emoji:t}of h(A).values())s.push(t);for(let[t,a]of e.items.entries())if(e.ssi==+t.split("_")[0]&&s.includes(a))return r=!0,e;return e}),r}}}function M(){const{set:n,subscribe:l,update:o}=u({visible:!1,header:"",content:"",confirmText:"",onConfirm:r=>{},danger:!1,input:!1});return{set:n,subscribe:l,show:r=>o(e=>(e=r,e.visible=!0,e))}}function N(){const{set:n,subscribe:l,update:o}=u(new Map);return{set:n,subscribe:l,useStorage:r=>{const e=JSON.parse(localStorage.getItem(r+"_dt"));n(new Map(e)||new Map),l(s=>{localStorage.setItem(r+"_dt",JSON.stringify(Array.from(s.entries())))})},add:r=>o(e=>(e.set(r,[]),e)),removeChoice:(r,e)=>o(s=>{var a,i,c;let t=(a=s.get(r))==null?void 0:a.length;return s.get(r)[t-1]=(i=s.get(r))==null?void 0:i.at(-1).filter(({next:d})=>d!=e),s.delete(e),typeof((c=s.get(e))==null?void 0:c.at(-1))!="string"&&s.forEach((d,p)=>{p.includes(e)&&s.delete(p)}),s}),remove:r=>o(e=>{var s;return e.delete(r),typeof((s=e.get(r))==null?void 0:s.at(-1))!="string"&&e.forEach((t,a)=>{a.includes(r)&&e.delete(a)}),e}),addTextTo:(r,e)=>o(s=>{var t,a;if(typeof((t=s.get(r))==null?void 0:t.at(-1))!="string"){let i=s.get(r);i==null||i.splice((i==null?void 0:i.length)-1,0,e)}else(a=s.get(r))==null||a.push(e);return s}),addChoiceTo:(r,e)=>o(s=>{var c;const t=s.get(r);let a="";r.includes("_")?a=r.split("_")[0]+"_"+g():a=r+"_"+g(),s.set(a,[]);const i=new k(e.slice(0,4),e,a);return typeof(t==null?void 0:t.at(-1))=="string"?t==null||t.push([i]):(c=t==null?void 0:t.at(-1))==null||c.push(i),s})}}function C(){const{set:n,subscribe:l,update:o}=u(new Set);return{set:n,subscribe:l,update:o,useStorage:r=>{const e=JSON.parse(localStorage.getItem(r+"_ru"));n(new Set(e)||new Set),l(s=>{localStorage.setItem(r+"_ru",JSON.stringify(Array.from(s.values())))})},add:r=>o(e=>{if(e.has(r)&&e.delete(r),e.add(r),e.size>16){for(let s of e)if(r!=s){e.delete(s);break}}return e})}}const H=u(!1);u(!1);const R=M(),K=u(""),J=u(""),O=u(""),P=v([J,O],([n,l])=>n==null?void 0:n.replace("_",l)),Q=w(),V=I(),W=f("pushers"),X=f("mergers"),Y=f("effectors"),Z=f("interactables"),ee=f("sequencers"),A=f("controllables"),re=N(),se=u(new Set),te=C();export{G as C,z as D,_ as E,F as I,L as S,B as a,x as b,V as c,K as d,J as e,P as f,re as g,O as h,Z as i,ee as j,A as k,se as l,R as m,Y as n,X as o,W as p,H as q,te as r,Q as s,U as t,j as u};

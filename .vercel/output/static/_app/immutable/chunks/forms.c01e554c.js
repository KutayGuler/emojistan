import{p as f}from"./parse.d12b0d5b.js";import{j as h}from"./singletons.7082b28b.js";import{i as A}from"./navigation.bc243d4b.js";const w=h("apply_action");function E(e){const n=JSON.parse(e);return n.data&&(n.data=f(n.data)),n}function _(e,n=()=>{}){const c=async({action:a,result:r,reset:o})=>{r.type==="success"&&(o!==!1&&HTMLFormElement.prototype.reset.call(e),await A()),(location.origin+location.pathname===a.origin+a.pathname||r.type==="redirect"||r.type==="error")&&w(r)};async function s(a){var u,d,b;a.preventDefault();const r=new URL((u=a.submitter)!=null&&u.hasAttribute("formaction")?a.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(e).action),o=new FormData(e),l=(d=a.submitter)==null?void 0:d.getAttribute("name");l&&o.append(l,((b=a.submitter)==null?void 0:b.getAttribute("value"))??"");const p=new AbortController;let m=!1;const y=await n({action:r,cancel:()=>m=!0,controller:p,data:o,form:e,submitter:a.submitter})??c;if(m)return;let i;try{const t=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:o,signal:p.signal});i=E(await t.text()),i.type==="error"&&(i.status=t.status)}catch(t){if((t==null?void 0:t.name)==="AbortError")return;i={type:"error",error:t}}y({action:r,data:o,form:e,update:t=>c({action:r,result:i,reset:t==null?void 0:t.reset}),result:i})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",s)}}}export{_ as e};

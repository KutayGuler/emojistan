import{a8 as We,ap as Pt,aq as Ht,ar as Ot,S as bt,i as vt,s as be,k as K,a as W,l as P,m as H,h as k,c as Y,n as I,p as Ke,b as q,G as S,P as Oe,g as V,v as Ie,d as x,f as Ee,K as qe,L as ve,E as we,ad as yt,o as kt,as as qt,j as Lt,a2 as je,e as ee,a3 as Nt,a4 as Ut,O as It,T as Vt,q as te,r as le,u as Ae,$ as zt,w as Ft,N as Ye,W as Rt,y as Gt,z as Bt,A as Zt,B as Wt,F as ye}from"./index.8e69b878.js";import{w as Yt}from"./index.17127d3e.js";import{f as ke,H as Jt,J as Xt,D as Pe,c as Qt,K as ie}from"./index.8d01d5d1.js";import{g as xt,e as Je,d as Xe,E as $t,b as Q,u as ge,m as el}from"./store.55a48864.js";function Qe(i){return Object.prototype.toString.call(i)==="[object Date]"}function He(i,e){if(i===e||i!==i)return()=>i;const t=typeof i;if(t!==typeof e||Array.isArray(i)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(i)){const l=e.map((s,r)=>He(i[r],s));return s=>l.map(r=>r(s))}if(t==="object"){if(!i||!e)throw new Error("Object cannot be null");if(Qe(i)&&Qe(e)){i=i.getTime(),e=e.getTime();const r=e-i;return n=>new Date(i+n*r)}const l=Object.keys(e),s={};return l.forEach(r=>{s[r]=He(i[r],e[r])}),r=>{const n={};return l.forEach(f=>{n[f]=s[f](r)}),n}}if(t==="number"){const l=e-i;return s=>i+s*l}throw new Error(`Cannot interpolate ${t} values`)}function tl(i,e={}){const t=Yt(i);let l,s=i;function r(n,f){if(i==null)return t.set(i=n),Promise.resolve();s=n;let o=l,u=!1,{delay:g=0,duration:_=400,easing:d=Ot,interpolate:b=He}=We(We({},e),f);if(_===0)return o&&(o.abort(),o=null),t.set(i=s),Promise.resolve();const j=Pt()+g;let a;return l=Ht(U=>{if(U<j)return!0;u||(a=b(i,n),typeof _=="function"&&(_=_(i,n)),u=!0),o&&(o.abort(),o=null);const M=U-j;return M>_?(t.set(i=n),!1):(t.set(i=a(d(M/_))),!0)}),l.promise}return{set:r,update:(n,f)=>r(n(s,i),f),subscribe:t.subscribe}}function xe(i,e,t){const l=i.slice();return l[21]=e[t],l[23]=t,l}function $e(i,e,t){const l=i.slice();return l[24]=e[t],l[23]=t,l}function Ce(i){const e=i.slice(),t=e[9].includes(e[23]);return e[26]=t,e}function et(i){let e,t,l=i[4],s=[];for(let n=0;n<l.length;n+=1)s[n]=lt($e(i,l,n));const r=n=>x(s[n],1,1,()=>{s[n]=null});return{c(){e=K("ul");for(let n=0;n<s.length;n+=1)s[n].c();this.h()},l(n){e=P(n,"UL",{class:!0});var f=H(e);for(let o=0;o<s.length;o+=1)s[o].l(f);f.forEach(k),this.h()},h(){I(e,"class","flex w-full flex-col gap-2")},m(n,f){q(n,e,f);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null);t=!0},p(n,f){if(f&536){l=n[4];let o;for(o=0;o<l.length;o+=1){const u=$e(n,l,o);s[o]?(s[o].p(u,f),V(s[o],1)):(s[o]=lt(u),s[o].c(),V(s[o],1),s[o].m(e,null))}for(Ie(),o=l.length;o<s.length;o+=1)r(o);Ee()}},i(n){if(!t){for(let f=0;f<l.length;f+=1)V(s[f]);t=!0}},o(n){s=s.filter(Boolean);for(let f=0;f<s.length;f+=1)x(s[f]);t=!1},d(n){n&&k(e),je(s,n)}}}function tt(i){let e,t=i[24]+"",l,s,r,n;return{c(){e=K("li"),l=te(t),s=W(),this.h()},l(f){e=P(f,"LI",{class:!0});var o=H(e);l=le(o,t),s=Y(o),o.forEach(k),this.h()},h(){I(e,"class","max-w-xs rounded-xl bg-neutral p-2 px-4 text-lg text-neutral-content "+(i[26]?"mr-2 self-end":"ml-2 self-start"))},m(f,o){q(f,e,o),S(e,l),S(e,s),n=!0},p(f,o){i=f,(!n||o&16)&&t!==(t=i[24]+"")&&Ae(l,t)},i(f){n||(qe(()=>{n&&(r||(r=ve(e,ke,{x:i[26]?100:-100},!0)),r.run(1))}),n=!0)},o(f){r||(r=ve(e,ke,{x:i[26]?100:-100},!1)),r.run(0),n=!1},d(f){f&&k(e),f&&r&&r.end()}}}function lt(i){let e,t,l=i[23]<i[3]&&tt(Ce(i));return{c(){l&&l.c(),e=ee()},l(s){l&&l.l(s),e=ee()},m(s,r){l&&l.m(s,r),q(s,e,r),t=!0},p(s,r){s[23]<s[3]?l?(l.p(Ce(s),r),r&8&&V(l,1)):(l=tt(Ce(s)),l.c(),V(l,1),l.m(e.parentNode,e)):l&&(Ie(),x(l,1,1,()=>{l=null}),Ee())},i(s){t||(V(l),t=!0)},o(s){x(l),t=!1},d(s){l&&l.d(s),s&&k(e)}}}function st(i){let e,t,l,s=i[5],r=[];for(let n=0;n<s.length;n+=1)r[n]=rt(xe(i,s,n));return{c(){e=K("form");for(let n=0;n<r.length;n+=1)r[n].c();this.h()},l(n){e=P(n,"FORM",{class:!0});var f=H(e);for(let o=0;o<r.length;o+=1)r[o].l(f);f.forEach(k),this.h()},h(){I(e,"class","flex w-full flex-wrap gap-2 p-2")},m(n,f){q(n,e,f);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null);t||(l=[Nt(i[11].call(null,e)),Oe(e,"submit",Ut(i[10]))],t=!0)},p(n,f){if(f&32){s=n[5];let o;for(o=0;o<s.length;o+=1){const u=xe(n,s,o);r[o]?(r[o].p(u,f),V(r[o],1)):(r[o]=rt(u),r[o].c(),V(r[o],1),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}},i(n){for(let f=0;f<s.length;f+=1)V(r[f])},o:It,d(n){n&&k(e),je(r,n),t=!1,Vt(l)}}}function rt(i){let e,t=i[21].label+"",l,s,r,n,f;return{c(){e=K("button"),l=te(t),s=W(),this.h()},l(o){e=P(o,"BUTTON",{"data-text":!0,"data-next":!0,class:!0,type:!0});var u=H(e);l=le(u,t),s=Y(u),u.forEach(k),this.h()},h(){I(e,"data-text",r=i[21].text),I(e,"data-next",n=i[21].next),I(e,"class","btn-secondary btn flex-grow"),I(e,"type","submit")},m(o,u){q(o,e,u),S(e,l),S(e,s)},p(o,u){u&32&&t!==(t=o[21].label+"")&&Ae(l,t),u&32&&r!==(r=o[21].text)&&I(e,"data-text",r),u&32&&n!==(n=o[21].next)&&I(e,"data-next",n)},i(o){f||qe(()=>{f=zt(e,Jt,{delay:i[23]*100}),f.start()})},o:It,d(o){o&&k(e)}}}function ll(i){let e,t,l,s,r,n,f,o,u,g,_,d=i[4]&&et(i),b=i[3]===i[4].length+1&&i[5]&&st(i);return{c(){e=K("div"),t=K("h1"),l=K("i"),r=W(),d&&d.c(),n=W(),b&&b.c(),this.h()},l(j){e=P(j,"DIV",{style:!0,class:!0});var a=H(e);t=P(a,"H1",{class:!0});var U=H(t);l=P(U,"I",{class:!0}),H(l).forEach(k),U.forEach(k),r=Y(a),d&&d.l(a),n=Y(a),b&&b.l(a),a.forEach(k),this.h()},h(){I(l,"class",s="twa twa-"+i[2]),I(t,"class","p-4"),Ke(e,"background-color","rgba(0, 0, 0.5, 0.8)"),I(e,"class",f="absolute z-50 flex flex-col items-start justify-start "+(i[1]?"h-[204px] w-[204px] 2xl:h-[236px] 2xl:w-[236px]":"h-[624px] w-[624px] 2xl:h-[720px] 2xl:w-[720px]")+" overflow-y-auto overflow-x-hidden backdrop-blur")},m(j,a){q(j,e,a),S(e,t),S(t,l),S(e,r),d&&d.m(e,null),S(e,n),b&&b.m(e,null),i[15](e),u=!0,g||(_=Oe(window,"keydown",i[14]),g=!0)},p(j,[a]){(!u||a&4&&s!==(s="twa twa-"+j[2]))&&I(l,"class",s),j[4]?d?(d.p(j,a),a&16&&V(d,1)):(d=et(j),d.c(),V(d,1),d.m(e,n)):d&&(Ie(),x(d,1,1,()=>{d=null}),Ee()),j[3]===j[4].length+1&&j[5]?b?(b.p(j,a),a&56&&V(b,1)):(b=st(j),b.c(),V(b,1),b.m(e,null)):b&&(b.d(1),b=null),(!u||a&2&&f!==(f="absolute z-50 flex flex-col items-start justify-start "+(j[1]?"h-[204px] w-[204px] 2xl:h-[236px] 2xl:w-[236px]":"h-[624px] w-[624px] 2xl:h-[720px] 2xl:w-[720px]")+" overflow-y-auto overflow-x-hidden backdrop-blur"))&&I(e,"class",f)},i(j){u||(V(d),V(b),j&&qe(()=>{u&&(o||(o=ve(e,ke,{x:-100},!0)),o.run(1))}),u=!0)},o(j){x(d),j&&(o||(o=ve(e,ke,{x:-100},!1)),o.run(0)),u=!1},d(j){j&&k(e),d&&d.d(),b&&b.d(),i[15](null),j&&o&&o.end(),g=!1,_()}}}function sl(i,e,t){let l;we(i,xt,h=>t(19,l=h));const s=yt();let{isTutorial:r=!1}=e,{character:n}=e,{dialogueID:f}=e,{dialogueTree:o=new Map}=e,{history:u={chatIndex:0,choices:[]}}=e,g=f,_=0,d=[],b,j=[],a=[];kt(()=>{if(o.size===0&&t(12,o=new Map(l)),u.chatIndex)for(let h of u.choices){b=o.get(g)||[],t(3,_+=b.length);let{text:G,next:se}=h;for(let N=0;N<b.length;N++){let L=b[N];j.push(typeof L=="string"?L:G)}t(4,j),d.push(j.length-1),g=se,t(7,O=!1)}else b=o.get(g)||[],M(),t(3,_++,_)});function U(h){var N,L;let G=(N=h.submitter)==null?void 0:N.dataset.text,se=(L=h.submitter)==null?void 0:L.dataset.next;t(5,a=[]),j.push(G),t(4,j),d.push(j.length-1),g=se,t(7,O=!1),t(0,u.chatIndex=_,u),u.choices.push({text:G,next:se}),M()}function M(){if(b=o.get(g)||[],!b)return;for(let G=0;G<b.length-1;G++)j.push(b[G]);let h=b.at(-1);typeof h=="string"?(j.push(h),t(4,j)):t(5,a=h)}let C,m=!1;qt(()=>{m=C&&C.offsetHeight+C.scrollTop>C.scrollHeight-C.offsetHeight*.1}),Lt(()=>{m&&C.scrollTo(0,C.scrollHeight)});let O=!1;function A(h){t(7,O=!0)}const X=h=>{if(h.code==="Escape"){s("end",{history:u});return}O||(h.code==="Space"&&t(3,_++,_),_===j.length+((a==null?void 0:a.length)||0)+1&&s("end",{history:u}))};function R(h){Ft[h?"unshift":"push"](()=>{C=h,t(6,C)})}return i.$$set=h=>{"isTutorial"in h&&t(1,r=h.isTutorial),"character"in h&&t(2,n=h.character),"dialogueID"in h&&t(13,f=h.dialogueID),"dialogueTree"in h&&t(12,o=h.dialogueTree),"history"in h&&t(0,u=h.history)},[u,r,n,_,j,a,C,O,s,d,U,A,o,f,X,R]}class rl extends bt{constructor(e){super(),vt(this,e,sl,ll,be,{isTutorial:1,character:2,dialogueID:13,dialogueTree:12,history:0})}}function nt(i,e,t){var f;const l=i.slice();l[56]=e[t],l[61]=t;const s=(f=l[16])==null?void 0:f.inventory.get(l[61]);l[57]=s;const r=l[61]===l[11];l[58]=r;const n=l[57]instanceof Q;return l[59]=n,l}function it(i,e,t){var u,g,_;const l=i.slice();l[56]=e[t],l[61]=t;const s=l[6]===l[61];l[62]=s;const r=l[8].get(l[7]+"_"+l[61]);l[57]=r;const n=l[9].get(`${l[7]}_${l[61]}`);l[63]=n;const f=l[19].get(`${l[7]}_${l[61]}`);l[64]=f;const o=((_=(g=(u=l[16])==null?void 0:u.inventory)==null?void 0:g.get(l[11]))==null?void 0:_.emoji)||l[20][l[10]].emoji;return l[65]=o,l}function nl(i){const e=i.slice(),t=e[57]instanceof Q;return e[67]=t,e}function Se(i){var l,s;const e=i.slice(),t=e[18]*(((s=(l=e[16])==null?void 0:l.hp)==null?void 0:s.max)||1);return e[68]=t,e}function ot(i){let e,t,l,s,r,n,f,o=(Number.isInteger(i[68])?i[68]:i[68].toFixed(1))+"",u;return{c(){e=K("div"),t=K("i"),s=W(),r=K("progress"),n=W(),f=K("p"),u=te(o),this.h()},l(g){e=P(g,"DIV",{class:!0});var _=H(e);t=P(_,"I",{class:!0}),H(t).forEach(k),s=Y(_),r=P(_,"PROGRESS",{title:!0,class:!0}),H(r).forEach(k),n=Y(_),f=P(_,"P",{class:!0});var d=H(f);u=le(d,o),d.forEach(k),_.forEach(k),this.h()},h(){var g;I(t,"class",l="twa z-10 text-2xl twa-"+((g=i[16])==null?void 0:g.emoji)+" svelte-isv29t"),I(r,"title","Health Bar"),I(r,"class","progress h-8 svelte-isv29t"),r.value=i[18],I(f,"class","absolute pl-6"),I(e,"class","flex h-full w-64 flex-grow flex-row items-center justify-center")},m(g,_){q(g,e,_),S(e,t),S(e,s),S(e,r),S(e,n),S(e,f),S(f,u)},p(g,_){var d;_[0]&65536&&l!==(l="twa z-10 text-2xl twa-"+((d=g[16])==null?void 0:d.emoji)+" svelte-isv29t")&&I(t,"class",l),_[0]&262144&&(r.value=g[18]),_[0]&327680&&o!==(o=(Number.isInteger(g[68])?g[68]:g[68].toFixed(1))+"")&&Ae(u,o)},d(g){g&&k(e)}}}function ft(i){let e,t=i[6]!=-2&&i[4]&&ot(Se(i));return{c(){t&&t.c(),e=ee()},l(l){t&&t.l(l),e=ee()},m(l,s){t&&t.m(l,s),q(l,e,s)},p(l,s){l[6]!=-2&&l[4]?t?t.p(Se(l),s):(t=ot(Se(l)),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){t&&t.d(l),l&&k(e)}}}function ct(i){var l;let e,t;return e=new rl({props:{isTutorial:i[3]===4,history:(l=i[8].get(i[7]+"_"+i[6]))==null?void 0:l.history,character:i[13],dialogueID:i[14],dialogueTree:i[0]}}),e.$on("end",i[29]),{c(){Gt(e.$$.fragment)},l(s){Bt(e.$$.fragment,s)},m(s,r){Zt(e,s,r),t=!0},p(s,r){var f;const n={};r[0]&8&&(n.isTutorial=s[3]===4),r[0]&448&&(n.history=(f=s[8].get(s[7]+"_"+s[6]))==null?void 0:f.history),r[0]&8192&&(n.character=s[13]),r[0]&16384&&(n.dialogueID=s[14]),r[0]&1&&(n.dialogueTree=s[0]),e.$set(n)},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){x(e.$$.fragment,s),t=!1},d(s){Wt(e,s)}}}function at(i){let e,t,l;return{c(){e=K("div"),t=K("i"),this.h()},l(s){e=P(s,"DIV",{class:!0});var r=H(e);t=P(r,"I",{class:!0}),H(t).forEach(k),r.forEach(k),this.h()},h(){I(t,"class",l="twa twa-"+i[63].emoji+" svelte-isv29t"),I(e,"class","absolute z-[2] scale-150")},m(s,r){q(s,e,r),S(e,t)},p(s,r){r[0]&640&&l!==(l="twa twa-"+s[63].emoji+" svelte-isv29t")&&I(t,"class",l)},d(s){s&&k(e)}}}function ut(i){let e,t,l,s;return{c(){e=K("div"),t=K("i"),this.h()},l(r){e=P(r,"DIV",{class:!0});var n=H(e);t=P(n,"I",{class:!0}),H(t).forEach(k),n.forEach(k),this.h()},h(){I(t,"class",l="twa twa-"+i[65]+" svelte-isv29t"),I(e,"class",s="absolute z-[3] text-base "+i[10]+" "+i[15]+" svelte-isv29t")},m(r,n){q(r,e,n),S(e,t)},p(r,n){n[0]&68608&&l!==(l="twa twa-"+r[65]+" svelte-isv29t")&&I(t,"class",l),n[0]&33792&&s!==(s="absolute z-[3] text-base "+r[10]+" "+r[15]+" svelte-isv29t")&&I(e,"class",s)},d(r){r&&k(e)}}}function il(i){let e,t;return{c(){e=K("i"),this.h()},l(l){e=P(l,"I",{class:!0}),H(e).forEach(k),this.h()},h(){I(e,"class",t="twa scale-75 opacity-50 twa-"+i[64]+" svelte-isv29t")},m(l,s){q(l,e,s)},p(l,s){s[0]&128&&t!==(t="twa scale-75 opacity-50 twa-"+l[64]+" svelte-isv29t")&&I(e,"class",t)},d(l){l&&k(e)}}}function ht(i){let e,t,l;return{c(){e=K("span"),t=K("i"),this.h()},l(s){e=P(s,"SPAN",{class:!0});var r=H(e);t=P(r,"I",{class:!0}),H(t).forEach(k),r.forEach(k),this.h()},h(){I(t,"class",l="twa twa-"+i[57].emoji+" svelte-isv29t"),I(e,"class","svelte-isv29t"),ye(e,"effector",i[67])},m(s,r){q(s,e,r),S(e,t)},p(s,r){r[0]&384&&l!==(l="twa twa-"+s[57].emoji+" svelte-isv29t")&&I(t,"class",l),r[0]&384&&ye(e,"effector",s[67])},d(s){s&&k(e)}}}function _t(i){let e,t,l,s,r=i[63]&&at(i),n=i[62]&&ut(i);function f(_,d){return _[57]?ht:il}function o(_,d){return d===ht?nl(_):_}let u=f(i),g=u(o(i,u));return{c(){e=K("div"),r&&r.c(),t=W(),n&&n.c(),l=W(),g.c(),s=W(),this.h()},l(_){e=P(_,"DIV",{class:!0});var d=H(e);r&&r.l(d),t=Y(d),n&&n.l(d),l=Y(d),g.l(d),s=Y(d),d.forEach(k),this.h()},h(){I(e,"class","cell"),Ke(e,"background",i[12].get(`${i[7]}_${i[61]}`)||i[1].dbg)},m(_,d){q(_,e,d),r&&r.m(e,null),S(e,t),n&&n.m(e,null),S(e,l),g.m(e,null),S(e,s)},p(_,d){_[63]?r?r.p(_,d):(r=at(_),r.c(),r.m(e,t)):r&&(r.d(1),r=null),_[62]?n?n.p(_,d):(n=ut(_),n.c(),n.m(e,l)):n&&(n.d(1),n=null),u===(u=f(_))&&g?g.p(o(_,u),d):(g.d(1),g=u(o(_,u)),g&&(g.c(),g.m(e,s))),d[0]&4226&&Ke(e,"background",_[12].get(`${_[7]}_${_[61]}`)||_[1].dbg)},d(_){_&&k(e),r&&r.d(),n&&n.d(),g.d()}}}function mt(i){let e,t={length:ie},l=[];for(let s=0;s<t.length;s+=1)l[s]=gt(nt(i,t,s));return{c(){e=K("div");for(let s=0;s<l.length;s+=1)l[s].c();this.h()},l(s){e=P(s,"DIV",{title:!0,class:!0});var r=H(e);for(let n=0;n<l.length;n+=1)l[n].l(r);r.forEach(k),this.h()},h(){I(e,"title","Inventory"),I(e,"class","relative flex h-full w-full flex-row items-center justify-center gap-2")},m(s,r){q(s,e,r);for(let n=0;n<l.length;n+=1)l[n]&&l[n].m(e,null)},p(s,r){if(r[0]&67592){t={length:ie};let n;for(n=0;n<t.length;n+=1){const f=nt(s,t,n);l[n]?l[n].p(f,r):(l[n]=gt(f),l[n].c(),l[n].m(e,null))}for(;n<l.length;n+=1)l[n].d(1);l.length=t.length}},d(s){s&&k(e),je(l,s)}}}function dt(i){let e,t,l,s,r=(i[57].hp>1?i[57].hp:"")+"",n,f;return{c(){e=K("i"),l=W(),s=K("div"),n=te(r),this.h()},l(o){e=P(o,"I",{class:!0}),H(e).forEach(k),l=Y(o),s=P(o,"DIV",{class:!0});var u=H(s);n=le(u,r),u.forEach(k),this.h()},h(){I(e,"class",t="twa twa-"+(i[57].emoji||"")+" svelte-isv29t"),I(s,"class",f=(i[59]?"":"hidden")+" absolute -top-0.5 right-0.5 text-sm")},m(o,u){q(o,e,u),q(o,l,u),q(o,s,u),S(s,n)},p(o,u){u[0]&65536&&t!==(t="twa twa-"+(o[57].emoji||"")+" svelte-isv29t")&&I(e,"class",t),u[0]&65536&&r!==(r=(o[57].hp>1?o[57].hp:"")+"")&&Ae(n,r),u[0]&65536&&f!==(f=(o[59]?"":"hidden")+" absolute -top-0.5 right-0.5 text-sm")&&I(s,"class",f)},d(o){o&&k(e),o&&k(l),o&&k(s)}}}function pt(i){let e,t,l,s,r,n,f,o;return{c(){e=K("div"),t=K("kbd"),l=te("F"),s=te(` to apply\r
							`),r=K("i"),f=te(` on self.\r
						`),this.h()},l(u){e=P(u,"DIV",{class:!0});var g=H(e);t=P(g,"KBD",{class:!0});var _=H(t);l=le(_,"F"),_.forEach(k),s=le(g,` to apply\r
							`),r=P(g,"I",{class:!0}),H(r).forEach(k),f=le(g,` on self.\r
						`),g.forEach(k),this.h()},h(){I(t,"class","kbd"),I(r,"class",n="twa twa-"+i[57].emoji+" svelte-isv29t"),I(e,"class",o="absolute "+(i[3]==Pe?"bottom-4":"-bottom-12"))},m(u,g){q(u,e,g),S(e,t),S(t,l),S(e,s),S(e,r),S(e,f)},p(u,g){g[0]&65536&&n!==(n="twa twa-"+u[57].emoji+" svelte-isv29t")&&I(r,"class",n),g[0]&8&&o!==(o="absolute "+(u[3]==Pe?"bottom-4":"-bottom-12"))&&I(e,"class",o)},d(u){u&&k(e)}}}function gt(i){let e,t,l,s,r=i[57]&&i[57].hp!=="Infinite"&&dt(i),n=i[59]&&i[58]&&pt(i);return{c(){e=K("div"),r&&r.c(),l=W(),n&&n.c(),s=ee(),this.h()},l(f){e=P(f,"DIV",{class:!0});var o=H(e);r&&r.l(o),o.forEach(k),l=Y(f),n&&n.l(f),s=ee(),this.h()},h(){I(e,"class",t="relative flex h-10 w-10 flex-col items-center justify-center rounded border "+(i[59]?"border-purple-500 bg-purple-50":"border-black bg-base-300")+" p-2 2xl:h-12 2xl:w-12 svelte-isv29t"),ye(e,"equipped",i[58])},m(f,o){q(f,e,o),r&&r.m(e,null),q(f,l,o),n&&n.m(f,o),q(f,s,o)},p(f,o){f[57]&&f[57].hp!=="Infinite"?r?r.p(f,o):(r=dt(f),r.c(),r.m(e,null)):r&&(r.d(1),r=null),o[0]&65536&&t!==(t="relative flex h-10 w-10 flex-col items-center justify-center rounded border "+(f[59]?"border-purple-500 bg-purple-50":"border-black bg-base-300")+" p-2 2xl:h-12 2xl:w-12 svelte-isv29t")&&I(e,"class",t),o[0]&67584&&ye(e,"equipped",f[58]),f[59]&&f[58]?n?n.p(f,o):(n=pt(f),n.c(),n.m(s.parentNode,s)):n&&(n.d(1),n=null)},d(f){f&&k(e),r&&r.d(),f&&k(l),n&&n.d(f),f&&k(s)}}}function wt(i){let e,t=i[6]!=-2&&i[5]&&mt(i);return{c(){t&&t.c(),e=ee()},l(l){t&&t.l(l),e=ee()},m(l,s){t&&t.m(l,s),q(l,e,s)},p(l,s){l[6]!=-2&&l[5]?t?t.p(l,s):(t=mt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){t&&t.d(l),l&&k(e)}}}function ol(i){let e,t=i[6],l,s,r,n,f,o=i[6],u,g,_,d=ft(i),b=i[17]&&ct(i),j={length:i[3]*i[3]},a=[];for(let M=0;M<j.length;M+=1)a[M]=_t(it(i,j,M));let U=wt(i);return{c(){e=K("div"),d.c(),l=W(),s=K("div"),b&&b.c(),r=W();for(let M=0;M<a.length;M+=1)a[M].c();f=W(),U.c(),this.h()},l(M){e=P(M,"DIV",{class:!0});var C=H(e);d.l(C),l=Y(C),s=P(C,"DIV",{class:!0});var m=H(s);b&&b.l(m),r=Y(m);for(let O=0;O<a.length;O+=1)a[O].l(m);m.forEach(k),f=Y(C),U.l(C),C.forEach(k),this.h()},h(){I(s,"class",n=Ye(i[2])+" svelte-isv29t"),I(e,"class","relative flex h-full flex-col items-center justify-center")},m(M,C){q(M,e,C),d.m(e,null),S(e,l),S(e,s),b&&b.m(s,null),S(s,r);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(s,null);S(e,f),U.m(e,null),u=!0,g||(_=Oe(window,"keydown",i[22]),g=!0)},p(M,C){if(C[0]&64&&be(t,t=M[6])?(d.d(1),d=ft(M),d.c(),d.m(e,l)):d.p(M,C),M[17]?b?(b.p(M,C),C[0]&131072&&V(b,1)):(b=ct(M),b.c(),V(b,1),b.m(s,r)):b&&(Ie(),x(b,1,1,()=>{b=null}),Ee()),C[0]&1679306){j={length:M[3]*M[3]};let m;for(m=0;m<j.length;m+=1){const O=it(M,j,m);a[m]?a[m].p(O,C):(a[m]=_t(O),a[m].c(),a[m].m(s,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=j.length}(!u||C[0]&4&&n!==(n=Ye(M[2])+" svelte-isv29t"))&&I(s,"class",n),C[0]&64&&be(o,o=M[6])?(U.d(1),U=wt(M),U.c(),U.m(e,null)):U.p(M,C)},i(M){u||(V(b),u=!0)},o(M){x(b),u=!1},d(M){M&&k(e),d.d(M),b&&b.d(),je(a,M),U.d(M),g=!1,_()}}}function fl(i,e,t){var Ze;let l,s,r;we(i,Je,c=>t(36,l=c)),we(i,Xe,c=>t(37,s=c));let{dt:n=new Map}=e,{map:f=new $t(new Map)}=e,{pushers:o=new Map}=e,{mergers:u=new Map}=e,{interactables:g=new Map}=e,{controllables:_=new Map}=e,{effectors:d=new Map}=e,{sequencers:b=new Map}=e,{mapClass:j=Xt}=e,{SIZE:a=Pe}=e,{showHP:U=!0}=e,{showInventory:M=!0}=e,C=new Map,m=-2,O,A=f.ssi,X="KeyD",R=0,h=new Map,G=new Map(f.colors),se=new Map(f.backgrounds),N={},L={},oe={};for(let[c,y]of structuredClone(_)){const{emoji:w,sideEffects:D,...E}=y;if(w!==""){L[w]={},Object.assign(L[w],E),L[w].id=c,L[w].sideEffects={};for(let[p,z]of D){let T=structuredClone(d.get(p));T&&(L[w].sideEffects[T.emoji]=z)}}}for(let[c,y]of d){const{emoji:w,...D}=y;w&&(oe[w]={},Object.assign(oe[w],D))}for(let[c,y]of structuredClone(g)){const{emoji:w,sideEffects:D,...E}=y;if(!w||!D)continue;N[w]={},Object.assign(N[w],E),N[w].id=c,N[w].sideEffects={};for(let[z,T,F]of D){if(T=="trigger"){let Z=structuredClone(b.get(F));T=(Z==null?void 0:Z.sequence)||[]}if(z==="any"){N[w].sideEffects.any=T;continue}let B=structuredClone(d.get(z));B&&(N[w].sideEffects[B.emoji]=T)}const p=N[w].drops[0];p&&(N[w].drops[0]=((Ze=d.get(p))==null?void 0:Ze.emoji)||"")}let Le="",Ne="",ae="";kt(()=>{Rt(Xe,[s,l]=["",""],s,Je.set(l))});const Et=yt(),ue={KeyW:{emoji:"up-arrow",operation:-a},KeyA:{emoji:"left-arrow",operation:-1},KeyS:{emoji:"down-arrow",operation:a},KeyD:{emoji:"right-arrow",operation:1}},jt=["KeyW","KeyA","KeyS","KeyD"],Ue={KeyW:"ArrowUp",KeyA:"ArrowLeft",KeyD:"ArrowRight",KeyS:"ArrowDown"};function he(c,y){let w=A+"_"+m,D=h.get(w);h.delete(w),t(7,A+=y),O+=c,t(6,m+=c),h.set(A+"_"+m,D),t(8,h)}const _e=a==4?(c,y)=>{if(c==="ArrowLeft"&&y%a===0||c==="ArrowUp"&&y<a||c==="ArrowRight"&&(y+1)%a===0||c==="ArrowDown"&&y>=a*a-a)return 0;switch(c){case"ArrowUp":return-a;case"ArrowRight":return 1;case"ArrowDown":return a;case"ArrowLeft":return-1}}:(c,y)=>c==="ArrowLeft"&&y%a===0?(A%a!=0&&!h.has(A-1+"_"+(m+a-1))&&he(a-1,-1),0):c==="ArrowUp"&&y<a?(A>=a&&!h.has(A-a+"_"+(m+a*(a-1)))&&he(a*(a-1),-a),0):c==="ArrowRight"&&(y+1)%a===0?((A+1)%a!=0&&!h.has(A+1+"_"+(m-a+1))&&he(-(a-1),1),0):c==="ArrowDown"&&y>=a*a-a?(A<a*a-a&&!h.has(A+a+"_"+(m-a*(a-1)))&&he(-(a*(a-1)),a),0):(["ArrowUp","ArrowDown"].includes(c)?a:1)*(["ArrowRight","ArrowDown"].includes(c)?1:-1);function De(c,y){let w=A+"_"+y,D=A+"_"+c;h.set(w,h.get(D)),h.delete(D),t(8,h),m===c&&(t(6,m=y),O=m+ue[X].operation)}function me(c){v.inventory.delete(c),t(16,v),t(8,h),t(7,A),t(6,m)}function At(c){let y=[];for(let w=0;w<ie;w++)v.inventory.get(w)||y.push(w);for(let w=0;w<y.length;w++)c[w]&&v.inventory.set(y[w],c[w]);t(16,v),t(8,h),t(7,A),t(6,m)}function Ve(c,y,w){var Z,pe,ce;let D=A+"_"+c,E=A+"_"+y,p=h.get(D),z=(p==null?void 0:p.inventory)||new Map,T=((Z=p==null?void 0:p.hp)==null?void 0:Z.current)||1,F=((pe=h.get(E))==null?void 0:pe.inventory)||new Map,B=new Map([...z,...F]);for(;B.size>ie;)B.delete(B.keys().next().value);h.set(E,new ge(w,B,((ce=N[w])==null?void 0:ce.hp)||T)),h.delete(D),t(8,h),m===c&&(t(6,m=y),O=m+ue[X].operation)}function ze(){var y,w,D,E;if(v.hp.current<=0){let p=(y=L[(v==null?void 0:v.emoji)||""])==null?void 0:y.devolve;if(p.to!==""){t(16,v.emoji=p.to,v),t(16,v.hp.max=((w=L[p.to])==null?void 0:w.hp)||1,v),t(16,v.hp.current=v.hp.max,v),de.set(Te());return}el.show({content:"No players left.",header:"Game Over",confirmText:"REPLAY",onConfirm:Ge.reset,input:!1,danger:!1});return}let c=(D=L[(v==null?void 0:v.emoji)||""])==null?void 0:D.evolve;(c==null?void 0:c.to)!==""&&v.hp.current>=(c==null?void 0:c.at)&&(t(16,v.emoji=c.to,v),t(16,v.hp.max=((E=L[c.to])==null?void 0:E.hp)||1,v),t(16,v.hp.current=v.hp.max,v)),de.set(Te())}function Fe(){var c,y,w,D;for(let[E,p]of f.items)if(oe[p]){let{hp:z,type:T}=oe[p];T=="collideable"||T=="both"?C.set(E,new Q(p,z,T)):h.set(E,new Q(p,z,T))}else L[p]||N[p]?h.set(E,new ge(p,new Map,1)):h.set(E,new ge(p));for(let[E,p]of h)if(!(p instanceof Q)){if(m===-2&&+E.split("_")[0]===A&&L[p.emoji]&&(t(6,m=+E.split("_")[1]),O=m+1,t(10,X="KeyD"),p.hp)){p.hp.max=((c=L[p.emoji])==null?void 0:c.hp)||1,p.hp.current=((y=L[p.emoji])==null?void 0:y.hp)||1;return}p.hp&&(p.hp.max=((w=N[p.emoji])==null?void 0:w.hp)||1,p.hp.current=((D=N[p.emoji])==null?void 0:D.hp)||1)}}Fe();let v=h.get(A+"_"+m),Re=new Map;for(let c=0;c<=100;c++)Re.set(c,c/100);function Te(){if(!v)return 0;let{hp:c}=v;return c?c.current>c.max?1:Re.get(Math.floor(c.current*100/c.max))||0:0}let de=tl(Te(),{duration:200,easing:Qt});we(i,de,c=>t(18,r=c));let $={};for(let[c,y]of[...u,...o]){let[w,D,E]=y;w!==""&&($[w]||($[w]={}),$[w][D]=E,E!="push"&&w!=D&&($[D]||($[D]={}),$[D][w]=E))}const Ge={paint({index:c,background:y}){G.set(`${A}_${c}`,y),t(12,G)},erase({index:c}){G.delete(`${A}_${c}`)},spawn({index:c,emoji:y}){h.set(A+"_"+c,new ge(y)),t(8,h)},destroy({index:c}){h.delete(A+"_"+c)},reset:()=>{h.clear(),t(12,G=new Map(f.colors)),t(6,m=-2),Fe(),t(8,h)},complete:()=>!0};function Be(c,y){return $[c]&&$[c][y]||"bump"}function Dt(c){var z;let y=[],w=0;for(;h.has(A+"_"+(m+c*w));)y.push((z=h.get(A+"_"+(m+c*w)))==null?void 0:z.emoji),w++;let D=[];for(let T=0;T<y.length-1;T++)D.push(Be(y[T],y[T+1]));let E=m+c*(w-1),p="";switch(c){case 1:p="ArrowRight";break;case-1:p="ArrowLeft";break;case a:p="ArrowDown";break;case-a:p="ArrowUp";break}if(_e(p,E)!==0)if(D.every(T=>T==="push")){let T=y.length;y.reverse();for(let F=T-1;F>=0;F--){let B=m+F*c,Z=m+(F+1)*c;De(B,Z)}}else{if(D.includes("bump")?D=D.slice(0,D.findIndex(T=>T==="bump")):D=D.slice(0,D.findIndex(T=>T!="push")+1),D.length===0||D.at(-1)==="push")return;for(let T=D.length-1;T>=0;T--){let F=m+T*c,B=m+(T+1)*c;D[T]!="push"?Ve(F,B,D[T]):De(F,B)}}}let fe=!1;function Tt(c){switch(c){case-1:return"left";case 1:return"right";case a:return"down";case-a:return"up";default:return""}}async function Mt(c){var y,w,D;if(t(15,ae=""),!(!h.has(A+"_"+m)||(((y=v==null?void 0:v.hp)==null?void 0:y.current)||-1)<=0||fe)){if(c.code.includes("Arrow")){let E=_e(c.code,m);if(!v||E===0||!L[v.emoji])return;let p=h.get(A+"_"+(m+E));if(!p){De(m,m+E);let T=C.get(`${A}_${m}`);if(T){let F=L[v.emoji].sideEffects[T.emoji];if(!F||F===0)return;v.hp.add(F),T.hp!=="Infinite"&&(T.hp-=1,T.hp<=0&&(C.delete(`${A}_${m}`),t(9,C))),ze()}return}let z=Be(v.emoji,p.emoji);switch(z){case"push":Dt(E);break;case"bump":break;default:Ve(m,m+E,z);break}return}if(c.code.includes("Digit")){let E=+c.code.replace("Digit","");t(11,R=E-1===R?-1:E-1);return}if(jt.includes(c.code)){t(10,X=c.code),O=m+ue[X].operation;return}if(c.code==="Space"&&!fe){const E=_e(Ue[X],m);if(E===0)return;let p=h.get(A+"_"+O)||C.get(`${A}_${O}`),z=h.has(A+"_"+O);if(p instanceof Q){if(v.inventory.size!=ie){for(let J=0;J<ie;J++)if(!v.inventory.get(J)){v.inventory.set(J,p),t(16,v),t(8,h),t(7,A),t(6,m);break}z?(h.delete(A+"_"+O),t(8,h)):(C.delete(`${A}_${O}`),t(9,C))}return}if(!p||!p.hp||!p.inventory)return;let T=N[p.emoji];if(!T)return;let F=((D=(w=v.inventory)==null?void 0:w.get(R))==null?void 0:D.emoji)||"any",{id:B,evolve:Z,sideEffects:pe,devolve:ce}=T;const re=pe[F];if(!re||re===0)return;if(re==="talk"){t(14,Ne=B.toString()),t(13,Le=p.emoji),t(17,fe=!0);return}else if(Array.isArray(re)){for(let{type:J,...Me}of re)Ge[J](Me);return}p.hp.current+=re,t(15,ae=Tt(E));let St=setTimeout(()=>{t(15,ae=""),clearTimeout(St)},50),ne=(v==null?void 0:v.inventory.get(R))||"any";if(ne instanceof Q&&ne.hp!=="Infinite"&&(ne.hp-=1),typeof ne!="string"&&ne instanceof Q&&ne.hp===0&&me(R),p.hp.current<=0){const J=N[p.emoji].drops;if(J[0]){const{hp:Me,type:Kt}=oe[J[0]];At(new Array(J[1]).fill(new Q(J[0],Me,Kt)))}ce.to!==""?p.emoji=ce.to:h.delete(A+"_"+O)}else(Z==null?void 0:Z.to)!==""&&p.hp.current>=Z.at&&(p.emoji=Z.to);t(8,h);return}if(c.code==="KeyF"){let E=v.inventory.get(R);if(!(E instanceof Q))return;const p=L[v.emoji].sideEffects[E.emoji];if(!p||p===0)return;v.hp.add(p),E.hp!=="Infinite"&&(E.hp-=1,E.hp<=0&&me(R)),ze();return}if(c.code.includes("Control")){if(_e(Ue[X],m)===0||!(v!=null&&v.inventory.get(R))||h.has(A+"_"+O))return;let E=v==null?void 0:v.inventory.get(R);if(!E)return;E.type=="equippable"?(h.set(A+"_"+O,E),me(R),t(8,h)):["collideable","both"].includes(E.type)&&(C.set(`${A}_${O}`,E),me(R),t(9,C));return}if(c.code==="Escape"){Et("quit");return}}}const Ct=c=>{h.get(`${A}_${m}`).history=c.detail.history,t(17,fe=!1)};return i.$$set=c=>{"dt"in c&&t(0,n=c.dt),"map"in c&&t(1,f=c.map),"pushers"in c&&t(23,o=c.pushers),"mergers"in c&&t(24,u=c.mergers),"interactables"in c&&t(25,g=c.interactables),"controllables"in c&&t(26,_=c.controllables),"effectors"in c&&t(27,d=c.effectors),"sequencers"in c&&t(28,b=c.sequencers),"mapClass"in c&&t(2,j=c.mapClass),"SIZE"in c&&t(3,a=c.SIZE),"showHP"in c&&t(4,U=c.showHP),"showInventory"in c&&t(5,M=c.showInventory)},i.$$.update=()=>{i.$$.dirty[0]&448&&t(16,v=h.get(A+"_"+m))},[n,f,j,a,U,M,m,A,h,C,X,R,G,Le,Ne,ae,v,fe,r,se,ue,de,Mt,o,u,g,_,d,b,Ct]}class _l extends bt{constructor(e){super(),vt(this,e,fl,ol,be,{dt:0,map:1,pushers:23,mergers:24,interactables:25,controllables:26,effectors:27,sequencers:28,mapClass:2,SIZE:3,showHP:4,showInventory:5},null,[-1,-1,-1])}}export{_l as G};
